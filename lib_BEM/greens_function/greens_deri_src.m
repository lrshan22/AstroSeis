function [gi1,gi2,gi3]=greens_deri_src(vp,vs,rho,w,...
    x,y,z,x0,y0,z0)
im = complex(0,1); 
R = sqrt( (x-x0).^2 + (y-y0).^2 + (z-z0).^2); 
g1 = (x-x0)./R; 
g2 = (y-y0)./R; 
g3 = (z-z0)./R; 
kp = w/vp; 
ks = w/vs;
Gs=exp(im*ks*R)./(4*pi*R);
Gp=exp(im*kp*R)./(4*pi*R);
%%
gi1=[g1.*R.^(-3).*(Gp.*(9+(sqrt(-1)*(-9)).*kp.*R+(-3).*kp.^2.*R.^2+ ...
  g1.^2.*((-15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)) ...
  .*kp.^3.*R.^3))+Gs.*((-9)+(sqrt(-1)*9).*ks.*R+4.*ks.^2.*R.^2+( ...
  sqrt(-1)*(-1)).*ks.^3.*R.^3+g1.^2.*(15+(sqrt(-1)*(-15)).*ks.*R+( ...
  -6).*ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3))),g2.*R.^(-3).*(Gp.*(3+( ...
  sqrt(-1)*(-3)).*kp.*R+(-1).*kp.^2.*R.^2+g1.^2.*((-15)+(sqrt(-1)* ...
  15).*kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)).*kp.^3.*R.^3))+Gs.*((-3) ...
  +(sqrt(-1)*3).*ks.*R+2.*ks.^2.*R.^2+(sqrt(-1)*(-1)).*ks.^3.*R.^3+ ...
  g1.^2.*(15+(sqrt(-1)*(-15)).*ks.*R+(-6).*ks.^2.*R.^2+sqrt(-1).* ...
  ks.^3.*R.^3))),g3.*R.^(-3).*(Gp.*(3+(sqrt(-1)*(-3)).*kp.*R+(-1).* ...
  kp.^2.*R.^2+g1.^2.*((-15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+( ...
  sqrt(-1)*(-1)).*kp.^3.*R.^3))+Gs.*((-3)+(sqrt(-1)*3).*ks.*R+2.* ...
  ks.^2.*R.^2+(sqrt(-1)*(-1)).*ks.^3.*R.^3+g1.^2.*(15+(sqrt(-1)*( ...
  -15)).*ks.*R+(-6).*ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3)));g2.*R.^( ...
  -3).*(Gp.*(3+(sqrt(-1)*(-3)).*kp.*R+(-1).*kp.^2.*R.^2+g1.^2.*(( ...
  -15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)).*kp.^3.* ...
  R.^3))+Gs.*((-3)+(sqrt(-1)*3).*ks.*R+ks.^2.*R.^2+g1.^2.*(15+(sqrt( ...
  -1)*(-15)).*ks.*R+(-6).*ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3))),g1.* ...
  R.^(-3).*(Gp.*(3+(sqrt(-1)*(-3)).*kp.*R+(-1).*kp.^2.*R.^2+g2.^2.*( ...
  (-15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)).*kp.^3.* ...
  R.^3))+Gs.*((-3)+(sqrt(-1)*3).*ks.*R+ks.^2.*R.^2+g2.^2.*(15+(sqrt( ...
  -1)*(-15)).*ks.*R+(-6).*ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3))),g1.* ...
  g2.*g3.*R.^(-3).*(Gp.*((-15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+( ...
  sqrt(-1)*(-1)).*kp.^3.*R.^3)+Gs.*(15+(sqrt(-1)*(-15)).*ks.*R+(-6) ...
  .*ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3));g3.*R.^(-3).*(Gp.*(3+(sqrt( ...
  -1)*(-3)).*kp.*R+(-1).*kp.^2.*R.^2+g1.^2.*((-15)+(sqrt(-1)*15).* ...
  kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)).*kp.^3.*R.^3))+Gs.*((-3)+( ...
  sqrt(-1)*3).*ks.*R+ks.^2.*R.^2+g1.^2.*(15+(sqrt(-1)*(-15)).*ks.*R+ ...
  (-6).*ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3))),g1.*g2.*g3.*R.^(-3).*( ...
  Gp.*((-15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)).* ...
  kp.^3.*R.^3)+Gs.*(15+(sqrt(-1)*(-15)).*ks.*R+(-6).*ks.^2.*R.^2+ ...
  sqrt(-1).*ks.^3.*R.^3)),g1.*R.^(-3).*(Gp.*(3+(sqrt(-1)*(-3)).*kp.* ...
  R+(-1).*kp.^2.*R.^2+g3.^2.*((-15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.* ...
  R.^2+(sqrt(-1)*(-1)).*kp.^3.*R.^3))+Gs.*((-3)+(sqrt(-1)*3).*ks.*R+ ...
  ks.^2.*R.^2+g3.^2.*(15+(sqrt(-1)*(-15)).*ks.*R+(-6).*ks.^2.*R.^2+ ...
  sqrt(-1).*ks.^3.*R.^3)))];


gi2=[g2.*R.^(-3).*(Gp.*(3+(sqrt(-1)*(-3)).*kp.*R+(-1).*kp.^2.*R.^2+ ...
  g1.^2.*((-15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)) ...
  .*kp.^3.*R.^3))+Gs.*((-3)+(sqrt(-1)*3).*ks.*R+ks.^2.*R.^2+g1.^2.*( ...
  15+(sqrt(-1)*(-15)).*ks.*R+(-6).*ks.^2.*R.^2+sqrt(-1).*ks.^3.* ...
  R.^3))),g1.*R.^(-3).*(Gp.*(3+(sqrt(-1)*(-3)).*kp.*R+(-1).*kp.^2.* ...
  R.^2+g2.^2.*((-15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*( ...
  -1)).*kp.^3.*R.^3))+Gs.*((-3)+(sqrt(-1)*3).*ks.*R+ks.^2.*R.^2+ ...
  g2.^2.*(15+(sqrt(-1)*(-15)).*ks.*R+(-6).*ks.^2.*R.^2+sqrt(-1).* ...
  ks.^3.*R.^3))),g1.*g2.*g3.*R.^(-3).*(Gp.*((-15)+(sqrt(-1)*15).* ...
  kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)).*kp.^3.*R.^3)+Gs.*(15+(sqrt( ...
  -1)*(-15)).*ks.*R+(-6).*ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3));g1.* ...
  R.^(-3).*(Gp.*(3+(sqrt(-1)*(-3)).*kp.*R+(-1).*kp.^2.*R.^2+g2.^2.*( ...
  (-15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)).*kp.^3.* ...
  R.^3))+Gs.*((-3)+(sqrt(-1)*3).*ks.*R+2.*ks.^2.*R.^2+(sqrt(-1)*(-1) ...
  ).*ks.^3.*R.^3+g2.^2.*(15+(sqrt(-1)*(-15)).*ks.*R+(-6).*ks.^2.* ...
  R.^2+sqrt(-1).*ks.^3.*R.^3))),g2.*R.^(-3).*(Gp.*(9+(sqrt(-1)*(-9)) ...
  .*kp.*R+(-3).*kp.^2.*R.^2+g2.^2.*((-15)+(sqrt(-1)*15).*kp.*R+6.* ...
  kp.^2.*R.^2+(sqrt(-1)*(-1)).*kp.^3.*R.^3))+Gs.*((-9)+(sqrt(-1)*9) ...
  .*ks.*R+4.*ks.^2.*R.^2+(sqrt(-1)*(-1)).*ks.^3.*R.^3+g2.^2.*(15+( ...
  sqrt(-1)*(-15)).*ks.*R+(-6).*ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3))), ...
  g3.*R.^(-3).*(Gp.*(3+(sqrt(-1)*(-3)).*kp.*R+(-1).*kp.^2.*R.^2+ ...
  g2.^2.*((-15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)) ...
  .*kp.^3.*R.^3))+Gs.*((-3)+(sqrt(-1)*3).*ks.*R+2.*ks.^2.*R.^2+( ...
  sqrt(-1)*(-1)).*ks.^3.*R.^3+g2.^2.*(15+(sqrt(-1)*(-15)).*ks.*R+( ...
  -6).*ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3)));g1.*g2.*g3.*R.^(-3).*( ...
  Gp.*((-15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)).* ...
  kp.^3.*R.^3)+Gs.*(15+(sqrt(-1)*(-15)).*ks.*R+(-6).*ks.^2.*R.^2+ ...
  sqrt(-1).*ks.^3.*R.^3)),g3.*R.^(-3).*(Gp.*(3+(sqrt(-1)*(-3)).*kp.* ...
  R+(-1).*kp.^2.*R.^2+g2.^2.*((-15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.* ...
  R.^2+(sqrt(-1)*(-1)).*kp.^3.*R.^3))+Gs.*((-3)+(sqrt(-1)*3).*ks.*R+ ...
  ks.^2.*R.^2+g2.^2.*(15+(sqrt(-1)*(-15)).*ks.*R+(-6).*ks.^2.*R.^2+ ...
  sqrt(-1).*ks.^3.*R.^3))),g2.*R.^(-3).*(Gp.*(3+(sqrt(-1)*(-3)).* ...
  kp.*R+(-1).*kp.^2.*R.^2+g3.^2.*((-15)+(sqrt(-1)*15).*kp.*R+6.* ...
  kp.^2.*R.^2+(sqrt(-1)*(-1)).*kp.^3.*R.^3))+Gs.*((-3)+(sqrt(-1)*3) ...
  .*ks.*R+ks.^2.*R.^2+g3.^2.*(15+(sqrt(-1)*(-15)).*ks.*R+(-6).* ...
  ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3)))];

gi3=[g3.*R.^(-3).*(Gp.*(3+(sqrt(-1)*(-3)).*kp.*R+(-1).*kp.^2.*R.^2+ ...
  g1.^2.*((-15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)) ...
  .*kp.^3.*R.^3))+Gs.*((-3)+(sqrt(-1)*3).*ks.*R+ks.^2.*R.^2+g1.^2.*( ...
  15+(sqrt(-1)*(-15)).*ks.*R+(-6).*ks.^2.*R.^2+sqrt(-1).*ks.^3.* ...
  R.^3))),g1.*g2.*g3.*R.^(-3).*(Gp.*((-15)+(sqrt(-1)*15).*kp.*R+6.* ...
  kp.^2.*R.^2+(sqrt(-1)*(-1)).*kp.^3.*R.^3)+Gs.*(15+(sqrt(-1)*(-15)) ...
  .*ks.*R+(-6).*ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3)),g1.*R.^(-3).*( ...
  Gp.*(3+(sqrt(-1)*(-3)).*kp.*R+(-1).*kp.^2.*R.^2+g3.^2.*((-15)+( ...
  sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)).*kp.^3.*R.^3))+ ...
  Gs.*((-3)+(sqrt(-1)*3).*ks.*R+ks.^2.*R.^2+g3.^2.*(15+(sqrt(-1)*( ...
  -15)).*ks.*R+(-6).*ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3)));g1.*g2.* ...
  g3.*R.^(-3).*(Gp.*((-15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+( ...
  sqrt(-1)*(-1)).*kp.^3.*R.^3)+Gs.*(15+(sqrt(-1)*(-15)).*ks.*R+(-6) ...
  .*ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3)),g3.*R.^(-3).*(Gp.*(3+(sqrt( ...
  -1)*(-3)).*kp.*R+(-1).*kp.^2.*R.^2+g2.^2.*((-15)+(sqrt(-1)*15).* ...
  kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)).*kp.^3.*R.^3))+Gs.*((-3)+( ...
  sqrt(-1)*3).*ks.*R+ks.^2.*R.^2+g2.^2.*(15+(sqrt(-1)*(-15)).*ks.*R+ ...
  (-6).*ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3))),g2.*R.^(-3).*(Gp.*(3+( ...
  sqrt(-1)*(-3)).*kp.*R+(-1).*kp.^2.*R.^2+g3.^2.*((-15)+(sqrt(-1)* ...
  15).*kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)).*kp.^3.*R.^3))+Gs.*((-3) ...
  +(sqrt(-1)*3).*ks.*R+ks.^2.*R.^2+g3.^2.*(15+(sqrt(-1)*(-15)).*ks.* ...
  R+(-6).*ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3)));g1.*R.^(-3).*(Gp.*(3+ ...
  (sqrt(-1)*(-3)).*kp.*R+(-1).*kp.^2.*R.^2+g3.^2.*((-15)+(sqrt(-1)* ...
  15).*kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)).*kp.^3.*R.^3))+Gs.*((-3) ...
  +(sqrt(-1)*3).*ks.*R+2.*ks.^2.*R.^2+(sqrt(-1)*(-1)).*ks.^3.*R.^3+ ...
  g3.^2.*(15+(sqrt(-1)*(-15)).*ks.*R+(-6).*ks.^2.*R.^2+sqrt(-1).* ...
  ks.^3.*R.^3))),g2.*R.^(-3).*(Gp.*(3+(sqrt(-1)*(-3)).*kp.*R+(-1).* ...
  kp.^2.*R.^2+g3.^2.*((-15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+( ...
  sqrt(-1)*(-1)).*kp.^3.*R.^3))+Gs.*((-3)+(sqrt(-1)*3).*ks.*R+2.* ...
  ks.^2.*R.^2+(sqrt(-1)*(-1)).*ks.^3.*R.^3+g3.^2.*(15+(sqrt(-1)*( ...
  -15)).*ks.*R+(-6).*ks.^2.*R.^2+sqrt(-1).*ks.^3.*R.^3))),g3.*R.^( ...
  -3).*(Gp.*(9+(sqrt(-1)*(-9)).*kp.*R+(-3).*kp.^2.*R.^2+g3.^2.*(( ...
  -15)+(sqrt(-1)*15).*kp.*R+6.*kp.^2.*R.^2+(sqrt(-1)*(-1)).*kp.^3.* ...
  R.^3))+Gs.*((-9)+(sqrt(-1)*9).*ks.*R+4.*ks.^2.*R.^2+(sqrt(-1)*(-1) ...
  ).*ks.^3.*R.^3+g3.^2.*(15+(sqrt(-1)*(-15)).*ks.*R+(-6).*ks.^2.* ...
  R.^2+sqrt(-1).*ks.^3.*R.^3)))];


gi1=gi1/(rho*w^2);

gi2=gi2/(rho*w^2);

gi3=gi3/(rho*w^2);
end