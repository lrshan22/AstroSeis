function [T11, T12, T13,T21,T22,T23,T31, T32, T33]...
    = green_traction_tensor (vp,vs,rho,w,...
    x1,x2,x3,xs,ys,zs,n1,n2,n3)  % surface normal
%% 
% Tij: traction vector i-th component; for the single-force 
% direction along 'j-th' direction; 
% vp, vs, rho: P-wave, s-wave velocity and density 
% w: angular frequency = 2*pi*f 
% (x1,x2,x3) field point 
% (n1,n2,n3) surface element normal direction at the field point 
% (xs,ys,zs) source point 
% author: Yingcai Zheng
% 3/17/2017
% 
mu =rho*vs*vs; 
lam = rho*vp*vp - 2*mu; 
im = complex(0,1); 
r = sqrt( (x1-xs).^2 + (x2-ys).^2 + (x3-zs).^2); 
g1 = (x1-xs)./r; 
g2 = (x2-ys)./r; 
g3 = (x3-zs)./r; 
kp = w/vp; 
ks = w/vs; 
Ep = exp(im*kp*r); 
Es = exp(im*ks*r); 
% Fp = (-3)+(sqrt(-1)*3).*kp.*r+kp.^2.*r.^2; 
% Fs = (-3)+(sqrt(-1)*3).*ks.*r+ks.^2.*r.^2;

% construct green traction tensor Tin where 'n' is the single-force direction 
% and 'i' is the traction force direction 
T11 = (1/4).*pi.^(-1).*r.^(-4).*(Ep.*(2.*mu.*(g2.*n2+g3.*n3).*((-3)+kp.* ...
  r.*((im*3)+kp.*r))+g1.*n1.*(kp.^2.*lam.*r.^2.*((-1)+im ...
  .*kp.*r)+6.*mu.*((-3)+kp.*r.*((im*3)+kp.*r)))+2.*g1.^3.*mu.* ...
  n1.*(15+im.*kp.*r.*((-15)+kp.*r.*((im*6)+kp.*r)))+2.* ...
  g1.^2.*mu.*(g2.*n2+g3.*n3).*(15+im.*kp.*r.*((-15)+kp.*r.*(( ...
  im*6)+kp.*r))))+Es.*mu.*(2.*g1.^3.*n1.*((-15)+ks.*r.*((sqrt( ...
  -1)*15)+ks.*r.*(6+(im*(-1)).*ks.*r)))+2.*g1.^2.*(g2.*n2+g3.* ...
  n3).*((-15)+ks.*r.*((im*15)+ks.*r.*(6+(im*(-1)).*ks.* ...
  r)))+(g2.*n2+g3.*n3).*(6+im.*ks.*r.*((-6)+ks.*r.*((im* ...
  3)+ks.*r)))+2.*g1.*n1.*(9+im.*ks.*r.*((-9)+ks.*r.*((im ...
  *4)+ks.*r))))).*rho.^(-1).*w.^(-2);
T21 = (1/4).*pi.^(-1).*r.^(-4).*(6.*(Ep+(-1).*Es).*mu.*((-1).*g1.*n2+5.* ...
  g1.*g2.^2.*n2+g2.*(((-1)+5.*g1.^2).*n1+5.*g1.*g3.*n3))+(im*( ...
  -6)).*(Ep.*kp+(-1).*Es.*ks).*mu.*((-1).*g1.*n2+5.*g1.*g2.^2.*n2+ ...
  g2.*(((-1)+5.*g1.^2).*n1+5.*g1.*g3.*n3)).*r+(-1).*(Es.*ks.^2.*mu.* ...
  (2.*g1.*n2+(-12).*g1.*g2.^2.*n2+3.*g2.*(n1+(-4).*g1.^2.*n1+(-4).* ...
  g1.*g3.*n3))+Ep.*kp.^2.*(g1.*(lam+(-2).*mu).*n2+12.*g1.*g2.^2.* ...
  mu.*n2+2.*g2.*mu.*((-1).*n1+6.*g1.^2.*n1+6.*g1.*g3.*n3))).*r.^2+ ...
  im.*(Es.*g2.*ks.^3.*mu.*(n1+(-2).*g1.^2.*n1+(-2).*g1.*(g2.* ...
  n2+g3.*n3))+Ep.*g1.*kp.^3.*(lam.*n2+2.*g2.*mu.*(g1.*n1+g2.*n2+g3.* ...
  n3))).*r.^3).*rho.^(-1).*w.^(-2);
T31= (1/4).*pi.^(-1).*r.^(-4).*(6.*(Ep+(-1).*Es).*mu.*(g3.*(((-1)+5.* ...
  g1.^2).*n1+5.*g1.*g2.*n2)+g1.*((-1)+5.*g3.^2).*n3)+(im*(-6)) ...
  .*(Ep.*kp+(-1).*Es.*ks).*mu.*(g3.*(((-1)+5.*g1.^2).*n1+5.*g1.*g2.* ...
  n2)+g1.*((-1)+5.*g3.^2).*n3).*r+(-1).*(Es.*ks.^2.*mu.*(3.*g3.*(n1+ ...
  (-4).*g1.^2.*n1+(-4).*g1.*g2.*n2)+2.*g1.*(1+(-6).*g3.^2).*n3)+Ep.* ...
  kp.^2.*(2.*g3.*mu.*(((-1)+6.*g1.^2).*n1+6.*g1.*g2.*n2)+g1.*(lam+ ...
  2.*((-1)+6.*g3.^2).*mu).*n3)).*r.^2+im.*(Es.*g3.*ks.^3.*mu.* ...
  (n1+(-2).*g1.^2.*n1+(-2).*g1.*(g2.*n2+g3.*n3))+Ep.*g1.*kp.^3.*( ...
  lam.*n3+2.*g3.*mu.*(g1.*n1+g2.*n2+g3.*n3))).*r.^3).*rho.^(-1).* ...
  w.^(-2);
T12 = (1/4).*pi.^(-1).*r.^(-4).*(6.*(Ep+(-1).*Es).*mu.*((-1).*g1.*n2+5.* ...
  g1.*g2.^2.*n2+g2.*(((-1)+5.*g1.^2).*n1+5.*g1.*g3.*n3))+(im*( ...
  -6)).*(Ep.*kp+(-1).*Es.*ks).*mu.*((-1).*g1.*n2+5.*g1.*g2.^2.*n2+ ...
  g2.*(((-1)+5.*g1.^2).*n1+5.*g1.*g3.*n3)).*r+(-1).*(Ep.*kp.^2.*( ...
  g2.*(lam+(-2).*mu+12.*g1.^2.*mu).*n1+(-2).*g1.*mu.*n2+12.*g1.* ...
  g2.^2.*mu.*n2+12.*g1.*g2.*g3.*mu.*n3)+Es.*ks.^2.*mu.*(3.*g1.*n2+( ...
  -12).*g1.*g2.^2.*n2+2.*g2.*(n1+(-6).*g1.^2.*n1+(-6).*g1.*g3.*n3))) ...
  .*r.^2+im.*(Es.*g1.*ks.^3.*mu.*(n2+(-2).*g2.*(g1.*n1+g2.*n2+ ...
  g3.*n3))+Ep.*g2.*kp.^3.*(lam.*n1+2.*g1.*mu.*(g1.*n1+g2.*n2+g3.*n3) ...
  )).*r.^3).*rho.^(-1).*w.^(-2);
T22 = (1/4).*pi.^(-1).*r.^(-4).*(6.*(Ep+(-1).*Es).*mu.*(g1.*((-1)+5.* ...
  g2.^2).*n1+(-3).*g2.*n2+5.*g2.^3.*n2+(-1).*g3.*n3+5.*g2.^2.*g3.* ...
  n3)+(im*(-6)).*(Ep.*kp+(-1).*Es.*ks).*mu.*(g1.*((-1)+5.* ...
  g2.^2).*n1+(-3).*g2.*n2+5.*g2.^3.*n2+(-1).*g3.*n3+5.*g2.^2.*g3.* ...
  n3).*r+(-1).*(Ep.*kp.^2.*(2.*g1.*((-1)+6.*g2.^2).*mu.*n1+g2.*(lam+ ...
  (-6).*mu+12.*g2.^2.*mu).*n2+2.*((-1)+6.*g2.^2).*g3.*mu.*n3)+Es.* ...
  ks.^2.*mu.*(3.*g1.*(1+(-4).*g2.^2).*n1+3.*g3.*n3+(-4).*g2.*((-2).* ...
  n2+3.*g2.^2.*n2+3.*g2.*g3.*n3))).*r.^2+im.*(Ep.*g2.*kp.^3.*( ...
  lam.*n2+2.*g2.*mu.*(g1.*n1+g2.*n2+g3.*n3))+Es.*ks.^3.*mu.*(g1.*( ...
  n1+(-2).*g2.^2.*n1)+g3.*n3+(-2).*g2.*(((-1)+g2.^2).*n2+g2.*g3.*n3) ...
  )).*r.^3).*rho.^(-1).*w.^(-2);
T32 = (1/4).*pi.^(-1).*r.^(-4).*(6.*(Ep+(-1).*Es).*mu.*(5.*g1.*g2.*g3.* ...
  n1+((-1)+5.*g2.^2).*g3.*n2+g2.*((-1)+5.*g3.^2).*n3)+(im*(-6) ...
  ).*(Ep.*kp+(-1).*Es.*ks).*mu.*(5.*g1.*g2.*g3.*n1+((-1)+5.*g2.^2).* ...
  g3.*n2+g2.*((-1)+5.*g3.^2).*n3).*r+(-1).*(Es.*ks.^2.*mu.*(3.*g3.*( ...
  n2+(-4).*g2.*(g1.*n1+g2.*n2))+2.*g2.*(1+(-6).*g3.^2).*n3)+Ep.* ...
  kp.^2.*(2.*g3.*mu.*((-1).*n2+6.*g2.*(g1.*n1+g2.*n2))+g2.*(lam+2.*( ...
  (-1)+6.*g3.^2).*mu).*n3)).*r.^2+im.*(Es.*g3.*ks.^3.*mu.*(n2+ ...
  (-2).*g2.*(g1.*n1+g2.*n2+g3.*n3))+Ep.*g2.*kp.^3.*(lam.*n3+2.*g3.* ...
  mu.*(g1.*n1+g2.*n2+g3.*n3))).*r.^3).*rho.^(-1).*w.^(-2);
T13 = (1/4).*pi.^(-1).*r.^(-4).*(6.*(Ep+(-1).*Es).*mu.*(g3.*(((-1)+5.* ...
  g1.^2).*n1+5.*g1.*g2.*n2)+g1.*((-1)+5.*g3.^2).*n3)+(im*(-6)) ...
  .*(Ep.*kp+(-1).*Es.*ks).*mu.*(g3.*(((-1)+5.*g1.^2).*n1+5.*g1.*g2.* ...
  n2)+g1.*((-1)+5.*g3.^2).*n3).*r+(-1).*(Es.*ks.^2.*mu.*(2.*g3.*(n1+ ...
  (-6).*g1.^2.*n1+(-6).*g1.*g2.*n2)+3.*g1.*(1+(-4).*g3.^2).*n3)+Ep.* ...
  kp.^2.*(g3.*(lam+2.*((-1)+6.*g1.^2).*mu).*n1+12.*g1.*g2.*g3.*mu.* ...
  n2+2.*g1.*((-1)+6.*g3.^2).*mu.*n3)).*r.^2+im.*(Es.*g1.* ...
  ks.^3.*mu.*(n3+(-2).*g3.*(g1.*n1+g2.*n2+g3.*n3))+Ep.*g3.*kp.^3.*( ...
  lam.*n1+2.*g1.*mu.*(g1.*n1+g2.*n2+g3.*n3))).*r.^3).*rho.^(-1).* ...
  w.^(-2);
T23 = (1/4).*pi.^(-1).*r.^(-4).*(6.*(Ep+(-1).*Es).*mu.*(5.*g1.*g2.*g3.* ...
  n1+((-1)+5.*g2.^2).*g3.*n2+g2.*((-1)+5.*g3.^2).*n3)+(im*(-6) ...
  ).*(Ep.*kp+(-1).*Es.*ks).*mu.*(5.*g1.*g2.*g3.*n1+((-1)+5.*g2.^2).* ...
  g3.*n2+g2.*((-1)+5.*g3.^2).*n3).*r+(-1).*(Es.*ks.^2.*mu.*(2.*g3.*( ...
  n2+(-6).*g2.*(g1.*n1+g2.*n2))+3.*g2.*(1+(-4).*g3.^2).*n3)+Ep.* ...
  kp.^2.*(12.*g1.*g2.*g3.*mu.*n1+g3.*(lam+(-2).*mu+12.*g2.^2.*mu).* ...
  n2+2.*g2.*((-1)+6.*g3.^2).*mu.*n3)).*r.^2+im.*(Es.*g2.* ...
  ks.^3.*mu.*(n3+(-2).*g3.*(g1.*n1+g2.*n2+g3.*n3))+Ep.*g3.*kp.^3.*( ...
  lam.*n2+2.*g2.*mu.*(g1.*n1+g2.*n2+g3.*n3))).*r.^3).*rho.^(-1).* ...
  w.^(-2);
T33 = (1/4).*pi.^(-1).*r.^(-4).*(6.*(Ep+(-1).*Es).*mu.*(((-1)+5.*g3.^2) ...
  .*(g1.*n1+g2.*n2)+g3.*((-3)+5.*g3.^2).*n3)+(im*(-6)).*(Ep.* ...
  kp+(-1).*Es.*ks).*mu.*(((-1)+5.*g3.^2).*(g1.*n1+g2.*n2)+g3.*((-3)+ ...
  5.*g3.^2).*n3).*r+(-1).*((2.*Ep.*((-1)+6.*g3.^2).*kp.^2+3.*Es.*(1+ ...
  (-4).*g3.^2).*ks.^2).*mu.*(g1.*n1+g2.*n2)+g3.*(4.*Es.*(2+(-3).* ...
  g3.^2).*ks.^2.*mu+Ep.*kp.^2.*(lam+6.*((-1)+2.*g3.^2).*mu)).*n3).* ...
  r.^2+im.*(Es.*ks.^3.*mu.*((-1).*((-1)+2.*g3.^2).*(g1.*n1+ ...
  g2.*n2)+(-2).*g3.*((-1)+g3.^2).*n3)+Ep.*g3.*kp.^3.*(lam.*n3+2.* ...
  g3.*mu.*(g1.*n1+g2.*n2+g3.*n3))).*r.^3).*rho.^(-1).*w.^(-2);
% T=[T11, T12, T13,T21,T22,T23,T31, T32, T33];
return 
% end
